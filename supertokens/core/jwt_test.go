package core

import (
	"testing"
)

func TestJWTInputOutput(t *testing.T) {
	var payload, err = verifyJWTAndGetPayload("eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsInZlcnNpb24iOiIyIn0=.eyJzZXNzaW9uSGFuZGxlIjoiY2ZmZmVkNGMtOTBiYi00M2IxLTlkZmUtMTViYzJmYmMwM2MyIiwidXNlcklkIjoiIiwicmVmcmVzaFRva2VuSGFzaDEiOiJjNjIzZTE4ODgzMThkZWM5OGZiNzE2YTY4OGZjNGVmZDM3YTM2ZGU3ZTNkNWEzZWFmYjVkMWNiYWVlYzU5ODlmIiwidXNlckRhdGEiOnt9LCJhbnRpQ3NyZlRva2VuIjoiNzc2ZjMwNmMtMzMxZS00ODZhLWFkNmQtZjYzOThlN2M0MzExIiwiZXhwaXJ5VGltZSI6MTU5MTUxNTgxMzkxOCwidGltZUNyZWF0ZWQiOjE1OTE1MTIyMTM5MTgsImlzUGFpZCI6dHJ1ZSwibG1ydCI6MTU5MTUxMjIxMzkxNn0=.W6KbJ2sh4qFBEiab5rCpaQ10vwzjn5fqlRzkIPQ+21wld4rsYuZcfbUx28dxFpH6As/t+S7agZhynDJmCeMVBkE1eIRVzawZhLOLiQ7HYrFJF2FOLFOK6faL2vGaptjqO1pNKIccLqn0yki/OFeBp6O2BH9IZwAKX6E5dVAMlCHccMDPmKbrpXu3KLP6dJqxpg2FotASay3EVP90uDl7dDNY4xxaF9WkYDuiKnFYhGbqsScmsSZSg4DPgyQHW1EfVq78TEKGaaJqnkcYrFT7fPqiQP2p5jQ/0OJ9lX8kQY2Cd6dpoyhaRQ0bZi+PgZiB9mRFI1Bh8c8jOwL/GsXQ7Q==",
		"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAj9/3hu27nm1PqWintvc8N/Hws7U65MlUfdmLxISipJuo/Q9kBDfFqfQ+Gm45sVyHKzCIfTZ7RqjTH6BeQHyia6LrjhZJN3CDPC0ROX32NfVlD+f/rb1Zo4ChuNr6ZcT8avuKI6tBsOnaJI/QWA6rAx98kZwk73ixyj72yvnfJhRxxcxNj1BGKIE+oaN2xkwBW3WmPN+LtLOz1M03rNiUF2tdiVW4S2rrSrKa37M2g6Y8vzxTU/d99wNAA7UfFLIRDp5eV21iGKxjAniMBlXrQ7EKcaK7TOWOMLtlufk873iVdWkTTitTUit0/lLtYyG2PZ3sifRnfMIRa/ojfbDk9QIDAQAB")
	if err != nil {
		t.Error(err)
		return
	}
	if payload["antiCsrfToken"] != "776f306c-331e-486a-ad6d-f6398e7c4311" ||
		int64(payload["expiryTime"].(float64)) != 1591515813918 ||
		payload["sessionHandle"] != "cfffed4c-90bb-43b1-9dfe-15bc2fbc03c2" ||
		payload["userId"] != "" {
		t.Error("returned payload is invalid")
		return
	}
}

func TestJWTInvalidHeaderInputOutput(t *testing.T) {
	var _, err = verifyJWTAndGetPayload("eyJhbGciOiJSUzI1iIsInR5cCI6IkpXVCIsInZlcnNpb24iOiIyIn0=.eyJzZXNzaW9uSGFuZGxlIjoiY2ZmZmVkNGMtOTBiYi00M2IxLTlkZmUtMTViYzJmYmMwM2MyIiwidXNlcklkIjoiIiwicmVmcmVzaFRva2VuSGFzaDEiOiJjNjIzZTE4ODgzMThkZWM5OGZiNzE2YTY4OGZjNGVmZDM3YTM2ZGU3ZTNkNWEzZWFmYjVkMWNiYWVlYzU5ODlmIiwidXNlckRhdGEiOnt9LCJhbnRpQ3NyZlRva2VuIjoiNzc2ZjMwNmMtMzMxZS00ODZhLWFkNmQtZjYzOThlN2M0MzExIiwiZXhwaXJ5VGltZSI6MTU5MTUxNTgxMzkxOCwidGltZUNyZWF0ZWQiOjE1OTE1MTIyMTM5MTgsImlzUGFpZCI6dHJ1ZSwibG1ydCI6MTU5MTUxMjIxMzkxNn0=.W6KbJ2sh4qFBEiab5rCpaQ10vwzjn5fqlRzkIPQ+21wld4rsYuZcfbUx28dxFpH6As/t+S7agZhynDJmCeMVBkE1eIRVzawZhLOLiQ7HYrFJF2FOLFOK6faL2vGaptjqO1pNKIccLqn0yki/OFeBp6O2BH9IZwAKX6E5dVAMlCHccMDPmKbrpXu3KLP6dJqxpg2FotASay3EVP90uDl7dDNY4xxaF9WkYDuiKnFYhGbqsScmsSZSg4DPgyQHW1EfVq78TEKGaaJqnkcYrFT7fPqiQP2p5jQ/0OJ9lX8kQY2Cd6dpoyhaRQ0bZi+PgZiB9mRFI1Bh8c8jOwL/GsXQ7Q==",
		"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAj9/3hu27nm1PqWintvc8N/Hws7U65MlUfdmLxISipJuo/Q9kBDfFqfQ+Gm45sVyHKzCIfTZ7RqjTH6BeQHyia6LrjhZJN3CDPC0ROX32NfVlD+f/rb1Zo4ChuNr6ZcT8avuKI6tBsOnaJI/QWA6rAx98kZwk73ixyj72yvnfJhRxxcxNj1BGKIE+oaN2xkwBW3WmPN+LtLOz1M03rNiUF2tdiVW4S2rrSrKa37M2g6Y8vzxTU/d99wNAA7UfFLIRDp5eV21iGKxjAniMBlXrQ7EKcaK7TOWOMLtlufk873iVdWkTTitTUit0/lLtYyG2PZ3sifRnfMIRa/ojfbDk9QIDAQAB")
	if err == nil {
		t.Error("should have failed")
	}
}

func TestJWTInvalidBodyInputOutput(t *testing.T) {
	var _, err = verifyJWTAndGetPayload("eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsInZlcnNpb24iOiIyIn0=.eyJzZXNzaW9uSGFuZGxlIjoiY2ZmZmVkNGMtOTBiYi00M2IxLTlkZmUtMTViYzJmYmMwM2MyIiwidXNlcklkIjoiIiwicmVmcmVzaFRva2VuSGFzaDEiOiJjNjIzZTE4ODgzMThkZWM5OGZiNzE2YY4OGZjNGVmZDM3YTM2ZGU3ZTNkNWEzZWFmYjVkMWNiYWVlYzU5ODlmIiwidXNlckRhdGEiOnt9LCJhbnRpQ3NyZlRva2VuIjoiNzc2ZjMwNmMtMzMxZS00ODZhLWFkNmQtZjYzOThlN2M0MzExIiwiZXhwaXJ5VGltZSI6MTU5MTUxNTgxMzkxOCwidGltZUNyZWF0ZWQiOjE1OTE1MTIyMTM5MTgsImlzUGFpZCI6dHJ1ZSwibG1ydCI6MTU5MTUxMjIxMzkxNn0=.W6KbJ2sh4qFBEiab5rCpaQ10vwzjn5fqlRzkIPQ+21wld4rsYuZcfbUx28dxFpH6As/t+S7agZhynDJmCeMVBkE1eIRVzawZhLOLiQ7HYrFJF2FOLFOK6faL2vGaptjqO1pNKIccLqn0yki/OFeBp6O2BH9IZwAKX6E5dVAMlCHccMDPmKbrpXu3KLP6dJqxpg2FotASay3EVP90uDl7dDNY4xxaF9WkYDuiKnFYhGbqsScmsSZSg4DPgyQHW1EfVq78TEKGaaJqnkcYrFT7fPqiQP2p5jQ/0OJ9lX8kQY2Cd6dpoyhaRQ0bZi+PgZiB9mRFI1Bh8c8jOwL/GsXQ7Q==",
		"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAj9/3hu27nm1PqWintvc8N/Hws7U65MlUfdmLxISipJuo/Q9kBDfFqfQ+Gm45sVyHKzCIfTZ7RqjTH6BeQHyia6LrjhZJN3CDPC0ROX32NfVlD+f/rb1Zo4ChuNr6ZcT8avuKI6tBsOnaJI/QWA6rAx98kZwk73ixyj72yvnfJhRxxcxNj1BGKIE+oaN2xkwBW3WmPN+LtLOz1M03rNiUF2tdiVW4S2rrSrKa37M2g6Y8vzxTU/d99wNAA7UfFLIRDp5eV21iGKxjAniMBlXrQ7EKcaK7TOWOMLtlufk873iVdWkTTitTUit0/lLtYyG2PZ3sifRnfMIRa/ojfbDk9QIDAQAB")
	if err == nil {
		t.Error("should have failed")
	}
}

func TestJWTInvalidSigInputOutput(t *testing.T) {
	var _, err = verifyJWTAndGetPayload("eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsInZlcnNpb24iOiIyIn0=.eyJzZXNzaW9uSGFuZGxlIjoiY2ZmZmVkNGMtOTBiYi00M2IxLTlkZmUtMTViYzJmYmMwM2MyIiwidXNlcklkIjoiIiwicmVmcmVzaFRva2VuSGFzaDEiOiJjNjIzZTE4ODgzMThkZWM5OGZiNzE2YTY4OGZjNGVmZDM3YTM2ZGU3ZTNkNWEzZWFmYjVkMWNiYWVlYzU5ODlmIiwidXNlckRhdGEiOnt9LCJhbnRpQ3NyZlRva2VuIjoiNzc2ZjMwNmMtMzMxZS00ODZhLWFkNmQtZjYzOThlN2M0MzExIiwiZXhwaXJ5VGltZSI6MTU5MTUxNTgxMzkxOCwidGltZUNyZWF0ZWQiOjE1OTE1MTIyMTM5MTgsImlzUGFpZCI6dHJ1ZSwibG1ydCI6MTU5MTUxMjIxMzkxNn0=.W6KbJ2sh4qFBEiab5rCpaQ10vwzjn5fqlRzkIPQ+21wld4rsYuZcfbUx28dxFpH6As/t+S7agZhynDJmCeMVBkE1eIRVzawZhLOLiQ7HYrFJF2FOLFOK6faL2vGaptjqO1pNKIccLqn0yki/OFeBp6O2BH9IZwAKX6E5dVAMlCHccMDPmKbrpXu3KLP6dJqxpg2FotASay3EVP90uDl7dDNY4xxaF9WkYDuiKnFYhGbqsScmsSZSg4DPgyQHW1EfVq78TEKGaaJqnkcYrFT7fPqiQP2p5jQ/0OJ9lX8kQY2Cd6doyhaRQ0bZi+PgZiB9mRFI1Bh8c8jOwL/GsXQ7Q==",
		"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAj9/3hu27nm1PqWintvc8N/Hws7U65MlUfdmLxISipJuo/Q9kBDfFqfQ+Gm45sVyHKzCIfTZ7RqjTH6BeQHyia6LrjhZJN3CDPC0ROX32NfVlD+f/rb1Zo4ChuNr6ZcT8avuKI6tBsOnaJI/QWA6rAx98kZwk73ixyj72yvnfJhRxxcxNj1BGKIE+oaN2xkwBW3WmPN+LtLOz1M03rNiUF2tdiVW4S2rrSrKa37M2g6Y8vzxTU/d99wNAA7UfFLIRDp5eV21iGKxjAniMBlXrQ7EKcaK7TOWOMLtlufk873iVdWkTTitTUit0/lLtYyG2PZ3sifRnfMIRa/ojfbDk9QIDAQAB")
	if err == nil {
		t.Error("should have failed")
	}
}

func TestJWTInvalidKeyInputOutput(t *testing.T) {
	var _, err = verifyJWTAndGetPayload("eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsInZlcnNpb24iOiIyIn0=.eyJzZXNzaW9uSGFuZGxlIjoiY2ZmZmVkNGMtOTBiYi00M2IxLTlkZmUtMTViYzJmYmMwM2MyIiwidXNlcklkIjoiIiwicmVmcmVzaFRva2VuSGFzaDEiOiJjNjIzZTE4ODgzMThkZWM5OGZiNzE2YTY4OGZjNGVmZDM3YTM2ZGU3ZTNkNWEzZWFmYjVkMWNiYWVlYzU5ODlmIiwidXNlckRhdGEiOnt9LCJhbnRpQ3NyZlRva2VuIjoiNzc2ZjMwNmMtMzMxZS00ODZhLWFkNmQtZjYzOThlN2M0MzExIiwiZXhwaXJ5VGltZSI6MTU5MTUxNTgxMzkxOCwidGltZUNyZWF0ZWQiOjE1OTE1MTIyMTM5MTgsImlzUGFpZCI6dHJ1ZSwibG1ydCI6MTU5MTUxMjIxMzkxNn0=.W6KbJ2sh4qFBEiab5rCpaQ10vwzjn5fqlRzkIPQ+21wld4rsYuZcfbUx28dxFpH6As/t+S7agZhynDJmCeMVBkE1eIRVzawZhLOLiQ7HYrFJF2FOLFOK6faL2vGaptjqO1pNKIccLqn0yki/OFeBp6O2BH9IZwAKX6E5dVAMlCHccMDPmKbrpXu3KLP6dJqxpg2FotASay3EVP90uDl7dDNY4xxaF9WkYDuiKnFYhGbqsScmsSZSg4DPgyQHW1EfVq78TEKGaaJqnkcYrFT7fPqiQP2p5jQ/0OJ9lX8kQY2Cd6dpoyhaRQ0bZi+PgZiB9mRFI1Bh8c8jOwL/GsXQ7Q==",
		"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAj9/3hu27nm1PqWintvc8N/Hws7U65MlUfdmLxISipJuo/Q9kBDfFqfQ+Gm45sVyHKzCIfTZ7RqjTH6BeQHyia6LrjhZJN3CDPC0ROX32NfVlD+f/rb1Zo4ChuNr6ZcT8avuKI6tBsOnaJI/QWA6rAx98kZk73ixyj72yvnfJhRxxcxNj1BGKIE+oaN2xkwBW3WmPN+LtLOz1M03rNiUF2tdiVW4S2rrSrKa37M2g6Y8vzxTU/d99wNAA7UfFLIRDp5eV21iGKxjAniMBlXrQ7EKcaK7TOWOMLtlufk873iVdWkTTitTUit0/lLtYyG2PZ3sifRnfMIRa/ojfbDk9QIDAQAB")
	if err == nil {
		t.Error("should have failed")
	}
}
